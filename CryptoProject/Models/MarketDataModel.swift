//
//  MarketDataModel.swift
//  CryptoProject
//
//  Created by AK on 8/10/24.
//

import Foundation


//https://api.coingecko.com/api/v3/global
//MarketDataModel


/*
{"data":{"active_cryptocurrencies":15034,"upcoming_icos":0,"ongoing_icos":49,"ended_icos":3376,"markets":1169,"total_market_cap":{"btc":36481631.34213169,"eth":844272028.8966041,"ltc":36536749342.06012,"bch":6255042606.511958,"bnb":4333481349.999612,"eos":4626182539822.249,"xrp":3795449948823.8887,"xlm":21947165944729.1,"link":209273884990.8402,"dot":468574200093.82776,"yfi":436421674.5381528,"usd":2226527328978.6323,"aed":8178034879338.52,"ars":2083384385740718.5,"aud":3385323477345.5635,"bdt":261745249206630.53,"bhd":839135846272.795,"bmd":2226527328978.6323,"brl":12259259473356.346,"cad":3062922320109.457,"chf":1926625230401.8557,"clp":2076949223017848.5,"cny":15956853408591.178,"czk":51488889788096.53,"dkk":15220206841798.588,"eur":2038241045403.5564,"gbp":1748765774308.3862,"gel":6000491151597.43,"hkd":17362571437741.82,"huf":803887692127735.6,"idr":3.551288824447631e+16,"ils":8293480321346.077,"inr":186925541397972.97,"jpy":326573669450611.9,"krw":3038820161773263.5,"kwd":681486578744.4636,"lkr":668039985721964.0,"mmk":4.67125433619716e+15,"mxn":41930630617524.4,"myr":9834571212098.627,"ngn":3.606974272945387e+15,"nok":24070096342656.414,"nzd":3713046034897.9126,"php":127446419857682.11,"pkr":620644492952792.2,"pln":8814113659735.807,"rub":193270734604533.53,"sar":8357697822568.468,"sek":23423624132687.47,"sgd":2946808919903.221,"thb":78404732975194.08,"try":74565289210357.06,"twd":72250811825356.77,"uah":91619727077986.94,"vef":222942181450.63037,"vnd":5.589376693677065e+16,"zar":41703135187685.945,"xdr":1676167624219.7056,"xag":81068861985.41002,"xau":915859751.502071,"bits":36481631342131.69,"sats":3.648163134213169e+15},"total_volume":{"btc":1608130.3930088882,"eth":37215975.81268071,"ltc":1610560024.7886603,"bch":275725721.54909706,"bnb":191022243.52625024,"eos":203924673108.12167,"xrp":167305523171.571,"xlm":967443156944.807,"link":9224908057.446318,"dot":20655008694.21051,"yfi":19237707.667478118,"usd":98146550383.57231,"aed":360492279558.86115,"ars":91836730644239.75,"aud":149226922530.70258,"bdt":11537874678009.752,"bhd":36989570055.11107,"bmd":98146550383.57231,"brl":540394906411.9489,"cad":135015302035.16129,"chf":84926700779.65704,"clp":91553065128803.95,"cny":703386882633.9482,"czk":2269658606930.18,"dkk":670915096439.543,"eur":89846787350.3856,"gbp":77086558041.91658,"gel":264504953283.72803,"hkd":765351707218.6158,"huf":35435812015988.8,"idr":1.565427663962941e+15,"ils":365581178196.25006,"inr":8239780768919.88,"jpy":14395547130960.082,"krw":133952865627259.14,"kwd":30040303555.202263,"lkr":29447570332306.883,"mmk":205911462704734.22,"mxn":1848325280788.553,"myr":433513313044.2392,"ngn":158997411621387.25,"nok":1061023097576.6471,"nzd":163673113281.65988,"php":5617908347662.571,"pkr":27358350919420.71,"pln":388530982365.5415,"rub":8519480378547.791,"sar":368411921002.4126,"sek":1032526246672.7771,"sgd":129896959432.65799,"thb":3456123792017.586,"try":3286878997217.1875,"twd":3184855559946.9272,"uah":4038648007035.1226,"vef":9827414089.90709,"vnd":2.463828016565996e+15,"zar":1838297157003.109,"xdr":73886391620.1097,"xag":3573560065.4135394,"xau":40371602.03477865,"bits":1608130393008.8882,"sats":160813039300888.8},"market_cap_percentage":{"btc":54.103682521469935,"eth":14.240530925750894,"usdt":5.190853878724674,"bnb":3.3663302965635467,"sol":3.247232273196982,"usdc":1.5481011581300634,"xrp":1.4776115906609961,"steth":1.1616735264633937,"ton":0.7699007103175367,"doge":0.6834577455489506},"market_cap_change_percentage_24h_usd":-0.46420918541170514,"updated_at":1723283342}}

*/


struct GlobalData: Codable {
    let data: MarketDataModel?
}

struct MarketDataModel: Codable {
    let totalMarketCap, totalVolume, marketCapPercentage: [String: Double]
    let marketCapChangePercentage24HUsd: Double
    
    enum CodingKeys: String, CodingKey {
        case totalMarketCap = "total_market_cap"
        case totalVolume = "total_volume"
        case marketCapPercentage = "market_cap_percentage"
        case marketCapChangePercentage24HUsd = "market_cap_change_percentage_24h_usd"
    }
    
    var marketCap: String {
        if let item = totalMarketCap.first(where: { $0.key == "usd" }) {
            return "$" + item.value.formattedWithAbbreviations()
        }
        return ""
    }
    
    var volume: String {
        if let item = totalVolume.first(where: { $0.key == "usd" }) {
            return "$" + item.value.formattedWithAbbreviations()
        }
        return ""
    }
    
    var btcDominance: String {
        if let item = marketCapPercentage.first(where: { $0.key == "btc" }) {
            return item.value.asPercentString()
        }
        return ""
    }
    
}

